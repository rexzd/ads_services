syntax = "proto3";

package messenger;

import "google/protobuf/empty.proto";

option java_package = "se.umu.cs.ads.a1.grpc";
option java_outer_classname = "MessengerProto";

message Message {
    string id = 1;
    int64 timestamp = 2;
    string username = 3;
    string topic = 4;
    string content = 5;
    bytes data = 6;
}

message MessageId {
    string id = 1;
}

message Username {
    string value = 1;
}

message Topic {
    string value = 1;
}

message StoreRequest {
    repeated Message messages = 1;
}

message RetrieveRequest {
    repeated MessageId ids = 1;
}

message RetrieveResponse {
    repeated Message messages = 1;
}

message DeleteRequest {
    repeated MessageId ids = 1;
}

message SubscriptionRequest {
    Username username = 1;
    Topic topic = 2;
}

message TopicList {
    repeated Topic topics = 1;
}

message UsernameList {
    repeated Username users = 1;
}

message MessageIdList {
    repeated MessageId ids = 1;
}

service MessengerService {
    rpc Store (StoreRequest) returns (google.protobuf.Empty);
    rpc Retrieve (RetrieveRequest) returns (RetrieveResponse);
    rpc Delete (DeleteRequest) returns (google.protobuf.Empty);
    rpc Subscribe (SubscriptionRequest) returns (TopicList);
    rpc Unsubscribe (SubscriptionRequest) returns (TopicList);
    rpc ListUsers (google.protobuf.Empty) returns (UsernameList);
    rpc ListTopics (google.protobuf.Empty) returns (TopicList);
    rpc ListUserTopics (Username) returns (TopicList);
    rpc ListSubscribers (Topic) returns (UsernameList);
    rpc ListUserMessages (Username) returns (MessageIdList);
    rpc ListTopicMessages (Topic) returns (MessageIdList);
}

message Request {
  oneof payload {
    StoreRequest store = 1;
    RetrieveRequest retrieve = 2;
    DeleteRequest delete = 3;
    SubscriptionRequest subscribe = 4;
    SubscriptionRequest unsubscribe = 5;
    Username listUserTopics = 6;
    Topic listSubscribers = 7;
    Username listUserMessages = 8;
    Topic listTopicMessages = 9;
    google.protobuf.Empty listUsers = 10;
    google.protobuf.Empty listTopics = 11;
  }
}

message Response {
  oneof payload {
    google.protobuf.Empty empty = 1;
    RetrieveResponse retrieveResp = 2;
    TopicList topicList = 3;
    UsernameList usernameList = 4;
    MessageIdList messageIdList = 5;
  }
}